# Synchronizing with Effects

`useEffect`ëŠ” ë Œë”ë§ ì´í›„ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” hookìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ React ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ë™ê¸°í™”í•  ë•Œ ìœ ìš©í•˜ë‹¤.


## What are Effects and how are they different from events?

#### Rendering Code
> ì»´í¬ë„ŒíŠ¸ì˜ ìµœìƒìœ„ ë ˆë²¨ì— ìˆëŠ” ë Œë”ë§ ì½”ë“œëŠ” propsì™€ stateë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  JSXë¥¼ ë°˜í™˜í•œë‹¤. (**ìˆœìˆ˜í•¨ìˆ˜**)

#### Event Handlers
> ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ì¤‘ì²©ëœ í•¨ìˆ˜ë¡œ  
> ì‚¬ìš©ìì˜ ì•¡ì…˜ì— ì˜í•´ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.  
> ex. input field ì—…ë°ì´íŠ¸, HTTP POST ìš”ì²­ ë“±  
> ì‚¬ìš©ìì˜ ì‘ì—…ì— ì˜í•´ ë°œìƒí•˜ëŠ” ë¶€ìˆ˜íš¨ê³¼(side effect)ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.  
> íŠ¹ì • ìƒí˜¸ ì‘ìš©ì— ì˜í•´ ë°œìƒí•˜ë©´ ì´ë²¤íŠ¸!~!!!!!

#### Effectë€?
- Side EffectëŠ” íŠ¹ì • ì´ë²¤íŠ¸ì— ì˜í•œ ê²ƒì´ ì•„ë‹ˆë¼ **ë Œë”ë§ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¶€ìˆ˜íš¨ê³¼ë¥¼ í‘œì‹œ**í•˜ëŠ” ê²ƒì´ë‹¤. (ë Œë”ë§ ìì²´ì— ì˜í•´ ë°œìƒ)
- **Side EffectëŠ” í™”ë©´ ì—…ë°ì´íŠ¸ í›„ ì»¤ë°‹ì´ ëë‚  ë•Œ! ì‹¤í–‰**ëœë‹¤. (ë Œë”ë§ ì¤‘ì— ë°œìƒí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë Œë”ë§ ì§í›„ ë°œìƒ, ì´ˆê¸° ë Œë”ë§ í¬í•¨)
- ì¼ë°˜ì ìœ¼ë¡œ Side EffectëŠ” ì™¸ë¶€ ì‹œìŠ¤í…œ(ë¸Œë¼ìš°ì € API, ì„œë“œíŒŒí‹° ìœ„ì ¯, ë„¤íŠ¸ì›Œí¬)ê³¼ ë™ê¸°í™” í•˜ëŠ”ë°ì— ì‚¬ìš©ëœë‹¤.
- ë”°ë¼ì„œ *ë‹¤ë¥¸ stateê¸°ë°˜ìœ¼ë¡œ stateë¥¼ ì¡°ì •í•˜ëŠ” ê²½ìš°ì—ëŠ” Side Effectê°€ í•„ìš”í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” ì‚¬ìš©ì„ ì§€ì–‘í•´ì•¼í•œë‹¤.*


## How to write an Effect
> Effect ì‘ì„± ë°©ë²•

1. **Declare an Effect**
   - useEffectë¥¼ ì„ ì–¸í•œë‹¤.
   - ëª¨ë“  ë Œë”ë§ ì´í›„ ì‹¤í–‰ë  ê²ƒ.
    ```jsx
    import { useEffect } from 'react';

    function MyComponent() {
      useEffect(() => {
        // ë§¤ ë Œë”ë§ í›„ì— ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
      });
      return <div />;
    }
    ```
    - ì»´í¬ë„ŒíŠ¸ëŠ” ë Œë”ë§ë  ë•Œë§ˆë‹¤ Reactí™”ë©´ì„ ì—…ë°ì´íŠ¸í•˜ê³  `useEffect`ë‚´ë¶€ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤.
    - `useEffect`ëŠ” ë Œë”ë§ì´ í™”ë©´ì— í‘œì‹œë  ë•Œê¹Œì§€ ì½”ë“œ ì‹¤í–‰ì„ ì§€ì—°í•œë‹¤.
    - ë³´í†µ DOM nodeë¥¼ ì¡°ì‘í•´ì•¼í•˜ëŠ” ì½”ë“œë“¤ì„ `useEffect`ì½œë°± ë‚´ë¶€ì— ì‘ì„±í•œë‹¤.
      ```js
      import { useEffect, useRef } from 'react';

      function VideoPlayer({ src, isPlaying }) {
        const ref = useRef(null);

        useEffect(() => {
          if (isPlaying) {
            ref.current.play(); // DOM node ì¡°ì‘ì€ ë Œë”ë§ ì´í›„ì— ì‹¤í–‰ë˜ì–´ì•¼í•¨!!
          } else {
            ref.current.pause();
          }
        }); // ì˜ì¡´ì„± ë°°ì—´ ì¶”ê°€í•´ì•¼ë¨

        return <video ref={ref} src={src} loop playsInline />;
      }
      ```
2. ğŸŒŸ **Specify the Effect dependencies**
   - ì˜ì¡´ì„±ì„ ëª…ì‹œí•œë‹¤.
   - EffectëŠ” ëª¨ë“  ë Œë”ë§ì´ ì•„ë‹ˆë¼ **í•„ìš”í•  ë•Œë§Œ ì¬ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ì˜ì¡´ì„±ì„ ì§€ì •**í•˜ì—¬ ì œì–´í•´ì•¼í•œë‹¤.
   - ì˜ì¡´ì„± ë°°ì—´ì„ ì§€ì •í•´ì£¼ë©´ ì´ì „ ë Œë”ë§ê³¼ ê°™ì„ ë•Œ Effectë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
   - ì˜ì¡´ì„± ë°°ì—´ì— ì—¬ëŸ¬ê°œì˜ ìš”ì†Œë¥¼ ì§€ì •í•˜ê²Œë˜ë©´  
  **ëª¨ë“  ì˜ì¡´ì„±ì´ ë§ˆì§€ë§‰ ë Œë”ë§ ì‹œì ê³¼ ì •í™•íˆ ë™ì¼í•œ ê²½ìš°**ì—ë§Œ Effectë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
     - `Object.is(a, b)` ë©”ì„œë“œë¡œ ë¹„êµí•œë‹¤.
   - ì˜ì¡´ì„± ë°°ì—´ì—ëŠ” `useEffect` ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ë³€ìˆ˜ë¥¼ ì§€ì •í•´ì•¼í•œë‹¤. (ì´ë•Œ `ref`ê°™ì´ ë Œë”ë§ê³¼ ìƒê´€ì—†ëŠ”, ë³€ê²½ë˜ì§€ì•ŠëŠ” ë³€ìˆ˜ëŠ” ì œì™¸í•¨)
      ```jsx
      import { useState, useRef, useEffect } from 'react';

      function VideoPlayer({ src, isPlaying }) {
        const ref = useRef(null);

        useEffect(() => {
          if (isPlaying) {
            console.log('Calling video.play()');
            ref.current.play();
          } else {
            console.log('Calling video.pause()');
            ref.current.pause();
          }
        }, [isPlaying]);
        // isPlayingì´ ë³€ê²½ë  ë•Œë§Œ Effectê°€ ì‹¤í–‰ë¨
        return <video ref={ref} src={src} loop playsInline />;
      }
      ```
      - `useEffect`ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜ê°€ `isPlaying`ë§ê³  `ref`ë„ ìˆì§€ë§Œ `ref`ë¥¼ ì˜ì¡´ì„±ë°°ì—´ì— ì¶”ê°€í•˜ì§€ì•ŠëŠ” ì´ìœ  : *`ref` ê°ì²´ê°€ ë Œë”ë§í• ë•Œë§ˆë‹¤ `useRef`ì—ì„œ ë™ì¼í•œ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê¸°ë•Œë¬¸ì— ì˜ì¡´ì„± ë°°ì—´ì— ì¶”ê°€í•  í•„ìš”ê°€ ì—†ë‹¤.*  
      *(ë³€ê²½ì‚¬í•­ì´ ê°ì§€ë˜ì§€ ì•Šê¸°ë•Œë¬¸ì— `ref`ë¡œ ì¸í•´ì„œ Effectê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤!, `ref.current` ë¡œ ì ‘ê·¼í•´ë„ ë§ˆì°¬ê°€ì§€)*
    - ë Œë”ë§ ë  ë•Œë§ˆë‹¤ ì‹¤í–‰
       ```jsx
       useEffect(() => {
         ... // ë Œë”ë§ë•Œë§ˆë‹¤ ì‹¤í–‰
       });
       ```
     - **ë¹ˆ ì˜ì¡´ì„± ë°°ì—´** : ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œë§Œ ì‹¤í–‰ (í™”ë©´ì— ì¶”ê°€ë˜ëŠ” ì‹œì )
       ```jsx
       useEffect(() => {
         ... // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œë§Œ ì‹¤í–‰ (ë‚˜íƒ€ë‚  ë•Œë§Œ)
       }, []); // ë‚´ë¶€ì½”ë“œê°€ propsë‚˜ stateë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ì§€ì •
       ```
     - ì˜ì¡´ì„±ì´ ë³€ê²½ë  ë•Œ ì‹¤í–‰
       ```jsx
       useEffect(() => {
         ... // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ë  ë•Œ + a ë˜ëŠ” b ë˜ëŠ” cê°€ ì§ì „ ë Œë”ë§ë•Œì™€ ë‹¬ë¼ì§€ë©´ ì‹¤í–‰ (ëª¨ë“  ì˜ì¡´ì„±ì´ ë˜‘ê°™ìœ¼ë©´ ì‹¤í–‰X)
       }, [a, b, c]); // ì˜ì¡´ì„± ì¡°ê±´ OR
       ```
1. **Add cleanup if needed**
   - í•„ìš”í•œ ê²½ìš° í´ë¦°ì—…í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ Effectê°€ ìˆ˜í–‰ ì¤‘ì´ë˜ ì‘ì—…ì„ ì¤‘ì§€í•˜ê±°ë‚˜ ì·¨ì†Œí•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì•¼í•œë‹¤.
      ```js
      export default function ChatRoom() {
        useEffect(() => {
          const connection = createConnection();
          connection.connect();
          // í´ë¦°ì—…í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ì—¬
          // Effectê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ê¸° ì „ì— ìˆ˜í–‰ë˜ì–´ì•¼í•  ì‘ì—…ì„ ì§€ì •í•¨
          // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ í•´ì œ(ì œê±°)ë  ë•Œ ë§ˆì§€ë§‰ìœ¼ë¡œ í•œë²ˆ ë” í˜¸ì¶œí•˜ê²Œ ë¨
          return () => {
            connection.disconnect();
          };
        }, []);
        // (ì˜ì¡´ì„±ë°°ì—´ []) ì²˜ìŒ í™”ë©´ ë Œë”ë§ë  ë•Œë§Œ(ë§ˆìš´íŠ¸ë  ë•Œ) ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡í•¨
        return <h1>Welcome to the chat!</h1>;
      }
      ```
   - ReactëŠ” Effectê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ê¸° ì „ì— ë§¤ë²ˆ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³   
    ì»´í¬ë„ŒíŠ¸ê°€ ì œê±°ë  ë•Œ(ë§ˆìš´íŠ¸í•´ì œ) ë§ˆì§€ë§‰ìœ¼ë¡œ í•œë²ˆ ë” í´ë¦°ì—…í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.
   - ê°œë°œí™˜ê²½(strict mode)ì—ì„œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë§ˆìš´íŠ¸í•˜ëŠ” ê±´ ì½”ë“œê°€ ê¹¨ì§€ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•¨ì´ê¸° ë•Œë¬¸ì— í´ë¦°ì—…í•¨ìˆ˜ë¥¼ ì˜ êµ¬í˜„í•´ë†“ìœ¼ë©´ ì‚¬ìš©ìê°€ ì²´ê°í•  ìˆ˜ ìˆëŠ” ì°¨ì´ê°€ ì—†ì„ ìˆ˜ ìˆë‹¤.
   - strict modeì—ì„œ ë‘ë²ˆ ì‹¤í–‰ë˜ì–´ë„ Effectê°€ ë¬¸ì œì—†ì´ ë™ì‘í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ì˜ êµ¬í˜„í•˜ëŠ” ê²ƒì´ê³  ì„¤ì •-> ì •ë¦¬ -> ì„¤ì • í•˜ëŠ” ì‹œí€€ìŠ¤ë¥¼ ì‚¬ìš©ìê°€ ëŠë‚„ ìˆ˜ ì—†ê²Œ í•´ì•¼í•œë‹¤.

#### Effect ë¬´í•œ ë£¨í”„ë¥¼ ìƒì„±í•˜ëŠ” ê²½ìš°

```jsx
const [count, setCount] = useState(0);
useEffect(() => {
  setCount(count + 1); // Effectë‚´ë¶€ì—ì„œ stateë¥¼ ì—…ë°ì´íŠ¸í•˜ë©´ ë¬´í•œë£¨í”„ê°€ ë°œìƒí•¨
});
```
- EffectëŠ” ë Œë”ë§ ì´í›„ì— ì‹¤í–‰ë˜ëŠ” ê²ƒì´ë‹¤. ë Œë”ë§ ê²°ê³¼ì— ì˜í•´ Effect ë‚´ë¶€ ì½”ë“œê°€ ì‹¤í–‰ë˜ë¯€ë¡œ  
  ìœ„ì˜ ì½”ë“œì—ì„œ `useEffect`ë‚´ë¶€ì— `state`ë¥¼ ì—…ë°ì´íŠ¸í•˜ê²Œ ë˜ë©´ ë˜ ë Œë”ë§ì„ íŠ¸ë¦¬ê³ í•˜ê³ ,   
  ê·¸ëŸ¼ Effectê°€ ì‹¤í–‰ë˜ê³  `state`ë¥¼ ë˜ ì—…ë°ì´íŠ¸í•˜ê³  ë˜ ë Œë”ë§ì´ ë°œìƒí•˜ë©´ì„œ ë¬´í•œë£¨í”„ê°€ ë°œìƒí•œë‹¤.
- EffectëŠ” ë³´í†µ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ë™ê¸°í™”í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ê³   
  ì´ë ‡ê²Œ `state`ê¸°ë°˜ìœ¼ë¡œ ì¼ë¶€ `state`ë§Œ ì¡°ì •í•˜ë ¤ëŠ” ê²½ìš°ì—” Effectê°€ í•„ìš”í•˜ì§€ì•Šì„ ìˆ˜ ìˆë‹¤.



## Subscribing to events
> ì´ë²¤íŠ¸ êµ¬ë…í•˜ê¸°


- Effect ë‚´ë¶€ ì½”ë“œì—ì„œ ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•œ ê²½ìš°, êµ¬ë…ì„ ì·¨ì†Œí•˜ëŠ” í´ë¦°ì—…í•¨ìˆ˜ë¥¼ ë°˜í™˜í•´ì•¼í•œë‹¤. (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
    ```js
    useEffect(() => {
      function handleScroll(e) {
        console.log(window.scrollX, window.scrollY);
      }
      window.addEventListener('scroll', handleScroll);
      // ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆê°€ ê³„ì† ì¼œì ¸ìˆìœ¼ë©´ ë¶ˆí•„ìš”í•œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•˜ê¸°ë•Œë¬¸ì— í´ë¦½ì—…í•¨ìˆ˜ë¥¼ ë°˜í™˜í•´ì•¼í•¨!
      return () => window.removeEventListener('scroll', handleScroll);
    }, []);
    ```
- React ê°œë°œí™˜ê²½ì€ ì½”ë“œì— ë²„ê·¸ê°€ ìˆëŠ”ì§€ ê²€ì‚¬í•˜ê¸° ìœ„í•´  
  ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ìµœì´ˆ ë§ˆìš´íŠ¸ ì§í›„ì— í•œë²ˆì”© ë‹¤ì‹œ ë§ˆìš´íŠ¸ë¥¼ í•œë‹¤.
  (ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ê³  ë‹¤ì‹œ ë§ˆìš´íŠ¸ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ëœ ìƒíƒœì—ì„œ ë‹¤ì‹œ ë§ˆìš´íŠ¸ëœë‹¤.)
- Effectê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ê¸° ì „ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ í•´ì œ(ì œê±°)ë  ë•Œ ë§ˆì§€ë§‰ìœ¼ë¡œ í•œë²ˆ ë” í´ë¦°ì—… í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼í•œë‹¤.



## Triggering animations
> ì• ë‹ˆë©”ì´ì…˜ ì´‰ë°œí•˜ê¸°

- Effectê°€ ì• ë‹ˆë©”ì´ì…˜ì„ ì´‰ë°œí•˜ëŠ” ê²½ìš° í´ë¦°ì—… í•¨ìˆ˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ì„ ì´ˆê¸°ê°’ìœ¼ë¡œ ì¬ì„¤ì •í•´ì•¼í•œë‹¤.
  ```js
  useEffect(() => {
    const node = ref.current;
    node.style.opacity = 1; // ì• ë‹ˆë©”ì´ì…˜ì„ ì ìš©í•˜ì˜€ìœ¼ë©´

    // ì´ˆê¸°í™”í•˜ëŠ” í´ë¦°ì—…í•¨ìˆ˜ë„ ê¼­ ì¶”ê°€í•´ì•¼í•œë‹¤. ì´ˆê¸°ê°’ìœ¼ë¡œ ì¬ì„¤ì •!!!
    return () => {
      node.style.opacity = 0;
    }
  }, []);
  ```
  - ê°œë°œí™˜ê²½ì—ì„œ ë¶ˆíˆ¬ëª…ë„ê°€ 1ì´ì—ˆë‹¤ê°€ 0ìœ¼ë¡œ ë°”ë€ë‹¤ìŒ, ë‹¤ì‹œ 1ë¡œ ì„¤ì •ëœë‹¤. (ìƒìš©í™˜ê²½ì—ì„œ 1ì„ í•œë²ˆë§Œ ì„¤ì •í•˜ëŠ” ê²ƒê³¼ ê°™ìŒ)


## Fetching data
> ğŸŒŸ ë°ì´í„° í˜ì¹­í•˜ê¸°

```jsx
useEffect(() => {
  let ignore = false; // 1ï¸âƒ£ ingore flag ìƒì„±

  async function startFetching() {
    const json = await fetchTodos(userId); // ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ë³´ë‚´ê³ 
    if (!ignore) setTodos(json);
  }
  startFetching(); // 2ï¸âƒ£
  return () => {
    // 3ï¸âƒ£ í´ë¦°ì—…í•¨ìˆ˜ë¡œ íŒ¨ì¹˜ë¥¼ ì¤‘ë‹¨í•˜ê±°ë‚˜ ê²°ê³¼ë¥¼ ë¬´ì‹œí•˜ê²Œë”í•¨
    ignore = true;
  };
}, [userId]);
```
- ê°œë°œí™˜ê²½ì—ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ë³´ë‚¸ ë’¤ í´ë¦°ì—… í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ ê´€ë ¨ì—†ëŠ” Fetchë¥¼ ì¤‘ë‹¨ì‹œí‚¤ê±°ë‚˜ ë¬´ì‹œí•˜ê²Œë”í•œë‹¤.
- ìœ„ì˜ ì½”ë“œì—ì„œëŠ” useEffectë‚´ë¶€ ì²«ë²ˆì§¸ fetchTodos()í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ë³´ë‚´ë©´, ì²«ë²ˆì§¸ EffectëŠ” ì¦‰ì‹œ ì •ë¦¬ë˜ì–´ ignoreë³€ìˆ˜ê°€ trueë¡œ ì„¤ì •ëœë‹¤.  
  ë§Œì•½ ê°œë°œí™˜ê²½ì—ì„œ ë‹¤ì‹œ ë§ˆìš´íŠ¸ëì„ ë•Œ if(!ignore) ì¡°ê±´ë¬¸ìœ¼ë¡œ ì¸í•´ stateëŠ” ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠëŠ”ë‹¤.


#### What are good alternatives to data fetching in Effects?
> Effectì—ì„œì˜ ë°ì´í„° íŒ¨ì¹­ ëŒ€ì•ˆì€ ë¬´ì—‡ì¸ê°€?

- ì´ˆê¸° ì„œë²„ ë Œë”ë§ë˜ëŠ” HTMLì—ëŠ” data ì—†ì´ ë¡œë”© stateë§Œ í¬í•¨ë˜ë©°  
  í´ë¼ì´ì–¸íŠ¸ ì»´í“¨í„°ì—ì„œ ëª¨ë“  JSë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì•±ì„ ë Œë”ë§í•˜ê³  ë‚œ í›„ ë°ì´í„°ë¥¼ ë¡œë“œí•œë‹¤.
- Effectì—ì„œ data fetchë¥¼ í•˜ê²Œë˜ë©´ ìƒìœ„ì»´í¬ë„ŒíŠ¸ì—ì„œ ë Œë”ë§ í›„ fetchí•˜ê³ , í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•œ ë‹¤ìŒ ë‹¤ì‹œ data fetchê°€ ì§„í–‰ëœë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ëª¨ë“  ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ íŒ¨ì¹˜í•˜ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ëŠë¦¬ê²Œ ëœë‹¤.
- Effectì—ì„œ ì§ì ‘ íŒ¨ì¹˜í•  ê²½ìš° dataë¥¼ ë¯¸ë¦¬ ë¡œë“œí•˜ê±°ë‚˜ ìºì‹œí•˜ì§€ ì•Šê¸°ë•Œë¬¸ì—  
  ì»´í¬ë„ŒíŠ¸ë¥¼ ë§ˆìš´íŒ…í•˜ê³ , ë§ˆìš´íŠ¸ í•´ì œë˜ì—ˆë‹¤ê°€ ë‹¤ì‹œ ë§ˆìš´íŠ¸ë˜ë©´ ë˜ ë‹¤ì‹œ fetchí•˜ê²Œ ëœë‹¤.
- ì´ë¥¼ ëŒ€ì²´í•˜ê¸° ìœ„í•œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ `React Query`, `useSWR` `React Router 6.4+` ë“±ì´ ìˆë‹¤.



## Sending analytics
> ë¶„ì„ ë³´ë‚´ê¸°

#### `intersection observers API`

- ë£¨íŠ¸ìš”ì†Œì™€ íƒ€ê²Ÿìš”ì†Œì˜ êµì°¨ì ì„ ê´€ì°°í•˜ê³  íƒ€ê²Ÿìš”ì†Œê°€ ë£¨íŠ¸ìš”ì†Œì™€ êµì°¨í•˜ëŠ”ì§€ ì•„ë‹Œì§€ êµ¬ë³„í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- scrollì´ë²¤íŠ¸ì™€ ë‹¤ë¥´ê²Œ êµì°¨ì‹œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³ 
- ê°€ì‹œì„± êµ¬ë¶„ì‹œ reflowë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.
- ë³´í†µ "ë¬´í•œìŠ¤í¬ë¡¤" ì›¹ì‚¬ì´íŠ¸ì™€ ê´‘ê³  ìˆ˜ìµ ê³„ì‚°ì„ ìœ„í•´ ê´‘ê³ ì˜ ê°€ì‹œì„± ë³´ê³ ì— ì‚¬ìš©ëœë‹¤.
- [ì°¸ê³ 1 - Intersection Observer - ìš”ì†Œì˜ ê°€ì‹œì„± ê´€ì°°](https://heropy.blog/2019/10/27/intersection-observer/), [ì°¸ê³ 2 - ì‹¤ë¬´ì—ì„œ ëŠë‚€ ì ì„ ê³ë“¤ì¸ Intersection Observer API](https://velog.io/@elrion018/%EC%8B%A4%EB%AC%B4%EC%97%90%EC%84%9C-%EB%8A%90%EB%82%80-%EC%A0%90%EC%9D%84-%EA%B3%81%EB%93%A4%EC%9D%B8-Intersection-Observer-API-%EC%A0%95%EB%A6%AC)


## Not an Effect: Initializing the application
> Effectê°€ ì•„ë‹˜: ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™”

- Appì»´í¬ë„ŒíŠ¸ê°€ ì‹¤í–‰ë  ë•Œ í•œë²ˆë§Œ ì‹¤í–‰ë˜ì–´ì•¼í•˜ëŠ” ë¡œì§ì€ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì— ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- **ì™¸ë¶€ì— ì‘ì„±í•œ ì½”ë“œëŠ” ë¸Œë¼ìš°ì €ê°€ í˜ì´ì§€ë¥¼ ë¡œë“œí•œ í›„ í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤**!!!
  ```js
  // ë¸Œë¼ìš°ì €ê°€ í˜ì´ì§€ ë¡œë“œí•œ í›„ 1ë²ˆë§Œ ì‹¤í–‰
  if (typeof window !== 'undefined') {
  // Server side rendering (next.js ì„œë²„í™˜ê²½ì€ window ê°ì²´ì—†ìŒ)ë•Œë¬¸ì— ì‹¤í–‰í™˜ê²½ì´ ë¸Œë¼ìš°ì €ì¸ì§€ í™•ì¸
    checkAuthToken();
    loadDataFromLocalStorage();
  }

  function App() {
    ...
  }
  ```


## Putting it all together

```jsx
import { useState, useEffect } from 'react';

function Playground() {
  const [text, setText] = useState('a');

  useEffect(() => {
    function onTimeout() {
      console.log('â°' + text);
    }

    console.log('ğŸ”µ' + text);
    const timeoutId = setTimeout(onTimeout, 3000);

    return () => {
      console.log('ğŸŸ¡' + text);
      clearTimeout(timeoutId); // ë””ë°”ìš´ìŠ¤ - ì¼ì • ì‹œê°„ë™ì•ˆ ë§ˆì§€ë§‰ 1ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ í•¨
    };
  }, [text]);

  return (
    <>
      <label>
        <input
          value={text}
          onChange={e => setText(e.target.value)}
        />
      </label>
    </>
  );
}

export default function App() {
  const [show, setShow] = useState(false);
  return (
    <>
      <button onClick={() => setShow(!show)}>
        {show ? 'Unmount' : 'Mount'} the component
      </button>
      {show && <hr />}
      {show && <Playground />}
    </>
  );
}
```
- ReactëŠ” ê°œë°œí™˜ê²½ì—ì„œ í´ë¦°ì—…ì„ ì˜ êµ¬í˜„í–ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´  
  ì»´í¬ë„ŒíŠ¸ë¥¼ ë§ˆìš´íŠ¸í•œ ë’¤ ë‹¤ì‹œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§ˆìš´íŠ¸í•œë‹¤.
- ReactëŠ” í•­ìƒ ë‹¤ìŒ ë Œë”ë§ì˜ Effectë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ì´ì „ Effectë¥¼ ì •ë¦¬í•˜ê¸°ë•Œë¬¸ì—  
  input valueë¥¼ ë¹ ë¥´ê²Œ ì…ë ¥í•˜ë”ë¼ë„ ìµœëŒ€ í•œë²ˆë§Œ timeoutì´ ì‹¤í–‰ë˜ê³ 
  ë§ˆìš´íŠ¸ê°€ í•´ì œë˜ë©´ ë§ˆì§€ë§‰ë Œë”ë§ì˜ EffectëŠ” ì‹¤í–‰ë˜ê¸° ì „ì— ë§ˆì§€ë§‰ timeoutì„ ì§€ìš´ë‹¤.
- ë§Œì•½ í´ë¦°ì—…í•¨ìˆ˜ê°€ ì—†ë‹¤ë©´ EffectëŠ” ê° ë Œë”ë§ë§ˆë‹¤ `state`ë¥¼ ìº¡ì³í•˜ê³  ê°ê°ì˜ timeoutì„ ê³„ì†í•´ì„œ ìƒì„±í•œë‹¤.

### Each render has its own Effects
> ê° ë Œë”ë§ì—ëŠ” ê³ ìœ í•œ Effectê°€ ìˆë‹¤.

`useEffect`ëŠ” ë Œë”ë§ ê²°ê³¼ì— ë™ì‘ì˜ ì¼ë¶€ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•œë‹¤.


```jsx
export default function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  return <h1>Welcome to {roomId}!</h1>;
}
```
#### ì´ˆê¸°ë Œë”ë§
- ì‚¬ìš©ìê°€ `<ChatRoom roomId={'general'}/>`ì»´í¬ë„ŒíŠ¸ë¥¼ ìƒì„±
- Effect : ë Œë”ë§ ì¶œë ¥ì˜ ì¼ë¶€ë¡œ 'roomId' ì±„íŒ…ë°©ì— ì—°ê²° ë©”ì„œë“œë¥¼ ì‹¤í–‰í•œë‹¤.

#### ë¦¬ë Œë”ë§ (ë™ì¼í•œ ì˜ì¡´ì„±ì— ì˜í•œ ë¦¬ë Œë”ë§)
- ì‚¬ìš©ìê°€ `<ChatRoom roomId={'general'}/>`ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§í•˜ëŠ”ë° ì´ë•Œ ì¶œë ¥ì´ ë³€ê²½ë˜ì§€ ì•Šì•˜ë‹¤ê³  íŒë‹¨í•˜ì—¬ DOM ì—…ë°ì´íŠ¸ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.
- Reactì—ì„œ ì²«ë²ˆì§¸ ë Œë”ë§ì˜ roomIdì™€ ë‘ë²ˆì§¸ ë Œë”ë§ì˜ roomIdë¥¼ ë¹„êµí•˜ì˜€ì„ ë•Œ ëª¨ë“  ì˜ì¡´ì„±ì´ ë™ì¼í•˜ê¸°ë•Œë¬¸ì— ë‘ë²ˆì§¸ ë Œë”ë§ì˜ EffectëŠ” ë¬´ì‹œí•œë‹¤. (í˜¸ì¶œX)

#### ë¦¬ë Œë”ë§ (ë‹¤ë¥¸ ì˜ì¡´ì„±ì— ì˜í•œ ë¦¬ë Œë”ë§)
- ì‚¬ìš©ìê°€ `<ChatRoom roomId={'travel'}/>`ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ìƒˆë¡œìš´ JSXë¥¼ ë°˜í™˜í•˜ê³  ReactëŠ” DOMì„ ì—…ë°ì´íŠ¸í•œë‹¤.
- Effect : ì˜ì¡´ì„±ì´ generalì—ì„œ travelë¡œ ë‹¬ë¼ì¡Œê¸° ë•Œë¬¸ì— ë‚´ë¶€ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤.
- EffectëŠ” í´ë¦°ì—…í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤í–‰ëœ Effectë¥¼ ìš°ì„  ì •ë¦¬í•˜ê³  (`disconnect()` - general)  
  ìƒˆë¡œìš´ Effectë¥¼ ì‹¤í–‰í•œë‹¤. (`connect()` - travel)

#### Unmount
- ì‚¬ìš©ìê°€ `<ChatRoom/>`ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸í•´ì œí•œ ê²½ìš° ReactëŠ” ë§ˆì§€ë§‰ Effectì˜ í´ë¦°ì—…í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤. (`disconnect()` - travel)

#### Strict Mode
- Reactì—ì„œ Strict ModeëŠ” ë§ˆìš´íŠ¸ í›„ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ í•œë²ˆ ë§ˆìš´íŠ¸í•œë‹¤. (`state`, DOM ë³´ì¡´)
- ì •ë¦¬ê°€ í•„ìš”í•œ Effectë¥¼ ì°¾ê³  [ì¡°ê±´ê²½í•©](https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect)ê°™ì€ ë²„ê·¸ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.


-----

#### ê³¼ì œ3

ê°œë°œì ëª¨ë“œì—ì„œ ê° ì»´í¬ë„ŒíŠ¸ë¥¼ ë§ˆìš´íŠ¸-ì–¸ë§ˆìš´íŠ¸-ë§ˆìš´íŠ¸í•˜ëŠ” ê³¼ì •ìœ¼ë¡œ ì¸í•´ intervalì´ ë‘ë²ˆ ì„¤ì •ë˜ëŠ” ë²„ê·¸ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²• ! => ***í´ë¦°ì—…í•¨ìˆ˜*** ì´ìš©!

```js
import { useState, useEffect } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    function onTick() {
      setCount(c => c + 1);
    }

    const time = setInterval(onTick, 1000);
    return () => clearInterval(time)
  }, []);

  return <h1>{count}</h1>;
}
```


----

#### ê³¼ì œ4

ë¹„ë™ê¸° ì—°ì‚°ì—ì„œ ì˜ˆê¸°ì¹˜ ì•ŠëŠ” ìˆœì„œë¡œ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²• ! => ***ignore flag***ì´ìš©!

```js
import { useState, useEffect } from 'react';
import { fetchBio } from './api.js';

export default function Page() {
  const [person, setPerson] = useState('Alice');
  const [bio, setBio] = useState(null);

  useEffect(() => {
    let ignore = false;
    setBio(null);
    fetchBio(person).then(bio => {
      if (!ignore) setBio(bio);
    });
    return () => {
      ignore = true;
    }
  }, [person]);

  return (
    <>
      <select value={person} onChange={e => {
        setPerson(e.target.value);
      }}>
        <option value="Alice">Alice</option>
        <option value="Bob">Bob</option>
        <option value="Taylor">Taylor</option>
      </select>
      <hr />
      <p><i>{bio ?? 'Loading...'}</i></p>
    </>
  );
}
```